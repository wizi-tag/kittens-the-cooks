#docker
### Что такое контейнеризация? 

Контейнеризация — это метод виртуализации, при котором приложения и их зависимости упаковываются в контейнеры. Контейнеры изолируют приложения и создают независимые от системы окружения, что делает процесс разработки и развертывания проще и предсказуемее.

---
### Основные команды Docker CLI 

- `docker build` - создание образа из Dockerfile.
- `docker run` - запуск контейнера на основе образа.
- `docker ps` - просмотр списка запущенных контейнеров.
- `docker stop` - остановка контейнера.
- `docker rm` - удаление контейнера.
- `docker rmi` - удаление образа.
- `docker pull` - загружает образ с Docker Hub.
- `docker images` - выводит список локальных образов.

[Docker Команды](https://docs.docker.com/reference/cli/docker/#subcommands)

---
### Как использовать Docker для контейнеризации? 

#### 1. Dockerfile
Dockerfile - файл, содержащий инструкции для сборки образа контейнера. Он начинается с команды `FROM`, которая указывает на образ-базу для вашего контейнера. Далее добавляются команды для установки зависимостей, копирования кода приложения и других необходимых действий.

- `FROM` - Указывает образ на котором будет основан контейнер
- `WORKDIR` - Указывает "домашнюю" директорию контейнера
- `COPY` - Копирует файлы и папки
- `ADD` - Добавляет локальные или удалённые файлы и директории.
- `RUN` - Выполняет команды на этапе сборки
- `EXPOSE` - Открывает порт для внешних источников
- `ENV` - Устанавливает переменные окружения
- `CMD` - Выполняет команды при запуске образа

Пример Dockerfile для приложения на Nest
```Dockerfile
# Указываем базовый образ
FROM node:22-alpine

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем package.json в WORKDIR
COPY package*.json ./

# Устанавливаем зависимости
RUN npm install

# Копируем исходный код
COPY . .

# Открываем порт для приложения
EXPOSE 3000

# Задаём переменные окружения
ENV NODE_ENV=production

# Запускаем приложение
CMD ["npm", "run", "start"]
```

[Команды Dockerfile](https://docs.docker.com/reference/dockerfile/)

#### 2. Сборка образа
После того как мы создали Dockerfile нужно создать образ нашего контейнера. Сделать это можно при помощи команды `docker build`

`docker build [опции] <путь>` - создает образ на основе указанного Dockerfile.
```bash
docker build -t my-app .
```
`-t <имя>` — задание имени образа.
`.` — путь к текущей директории с Dockerfile.

>  ❗ **Нейминг важен Dockerfile должен называться имнно** `Dockerfile`

#### 3. Запуск контейнера
Собрав образ *(это может быть долго)* нужно запустить его экземпляр (контейнер).
Сделать это можно при помощи команды `docker run`

> Да, мы можем поднимать много контейнеров основанных на одном образе, например поднять 3 контейнера с ubuntu и моделировать общение между серверами 

`docker run [опции] <образ>` - создает и запускает контейнер на основе образа.
```bash
docker run -d -p 4000:3000 --name my-application my-app
```
 `-d` - запуск в фоновом режиме (detached mode).
 `-p <хост-порт>:<контейнер-порт>` - проброс порта.
 `--name <имя>` - указание имени для контейнера.

#### 4. Завершение работы
Допустим, поработав с контейнером вы решили его выключить
Сделать это можно при помощи команды `docker stop`

`docker stop <имя или ID>` - останавливает контейнер.
```bash
docker stop my-app
```

К слову что такое ID контейнера и как его получить?
Для этого пригодится команда `docker ps`

`docker ps <опции>` - показывает список контейнеров
```bash
docker ps -a
```
`-a` - показывает все даже выключенные контейнеры

Если вдруг вы решили что контейнер вам больше не нужен его можно удалить.
Сделать это можно при помощи команды `docker rm`

`docker rm <имя или ID>` - удаляет остановленный контейнер
```bash
docker rm my-app
```

Как мы помним, для создания контейнера нам были нужны образы. Для просмотра информации о них воспользуемся командой `docker images`

`docker images <опции>`
```bash
docker images
```

Образы из этого списка хранятся на нашем устройстве. Чтобы лишние образы не занимали наш диск их мы можем удалять командой `docker rmi`

`docker rmi <имя или ID образа>` - удаляет образ.
```bash
docker rmi my-app
```

#### 5. Ещё немножко полезностей

`docker exec -it <имя или ID> <команда>` - выполняет команду внутри контейнера.
```bash
docker exec -it ubuntu bash
```
Это запустит терминальную сессию внутри контейнера.

`docker logs <имя или ID>` - отображает логи контейнера.
```bash
docker logs my-app
```
Эта команда покажет то что выводилось в консоль у этого контейнера. 

---
#### Заключение
Тема докера и контейнеризации - очень объёмная, но этих знаний будет достаточно для ознакомления с Docker и упаковки своего проекта в контейнер
Для более глубокого изучения темы рекомендую ознакомиться с:
- [Docker Hub](https://hub.docker.com/)
- [Docker Compose](https://docs.docker.com/compose/)
- [Volumes](https://docs.docker.com/engine/storage/volumes/)
- [Networks](https://docs.docker.com/engine/network/)

---
#### Запретные знания:

При помощи докера можно не только поднимать изолированно проекты, но и например базу данных.

```bash
docker run -d \ 
--name my_postgres \ 
-e POSTGRES_USER=myuser \ 
-e POSTGRES_PASSWORD=mypassword \ 
-e POSTGRES_DB=mydatabase \ 
-p 5432:5432 \ 
-v my_pgdata:/var/lib/postgresql/data \ 
postgres
```
Этот скрипт создаст контейнер `postgres` с готовым пользователем и базой данных.